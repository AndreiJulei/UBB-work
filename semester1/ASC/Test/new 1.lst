     1                                  bits 32 ; assembling for the 32 bits architecture
     2                                  
     3                                  ; declare the EntryPoint (a label defining the very first instruction of the program)
     4                                  global start        
     5                                  
     6                                  ; declare external functions needed by our program
     7                                  extern exit               ; tell nasm that exit exists even if we won't be defining it
     8                                  import exit msvcrt.dll    ; exit is a function that ends the calling process. It is defined in msvcrt.dll
     9                                                            ; msvcrt.dll contains exit, printf and all the other important C-runtime specific functions
    10                                  extern fprintf, fread, fopen, fclose, scanf, printf
    11                                  import fopen msvcrt.dll
    12                                  import fprintf msvcrt.dll
    13                                  import fclose msvcrt.dll
    14                                  import fread msvcrt.dll
    15                                  import printf msvcrt.dll
    16                                  import scanf msvcrt.dll		  
    17                                  ; our data is declared here (the variables needed by our program)
    18                                  segment data use32 class=data
    19                                      ; ...
    20                                  	
    21 00000000 696E7075742E747874-     	input db "input.txt",0
    21 00000009 00                 
    22 0000000A 6F75747075742E7478-     	output db "output.txt",0
    22 00000013 7400               
    23 00000015 <res 00000064>          	buffer resb 100
    24 00000079 00000000                	id dd 0
    25 0000007D <res 00000064>          	sir_final resb 100
    26 000000E1 7700                    	access_write db "w",0
    27 000000E3 7200                    	access_read db "r",0
    28 000000E5 257300                  	string db "%s",0
    29                                  	
    30                                  
    31                                  ; our code starts here
    32                                  segment code use32 class=code
    33                                      start:
    34                                          ; ...
    35                                  		
    36 00000000 68[E3000000]            		push access_read
    37 00000005 68[00000000]            		push input
    38 0000000A FF15[00000000]          		call [fopen]
    39                                  		
    40 00000010 A3[79000000]            		mov [id],eax
    41                                  		
    42 00000015 BF[7D000000]            		mov edi,sir_final
    43                                  		
    44 0000001A 50                      		push eax
    45 0000001B 6A64                    		push 100
    46 0000001D 6A01                    		push 1
    47 0000001F 68[15000000]            		push buffer
    48 00000024 FF15[00000000]          		call [fread]
    49                                  		
    50 0000002A BE00000000              		mov esi,0
    51                                  		
    52                                  		modificare_sir:
    53 0000002F 8A86[15000000]          			mov al,byte[buffer+esi]
    54 00000035 3C00                    			cmp al,0
    55 00000037 7421                    			je done 
    56                                  			
    57 00000039 3C30                    			cmp al,"0"
    58 0000003B 7C0A                    			jl stocare_litera
    59                                  			
    60 0000003D 3C39                    			cmp al,"9"
    61 0000003F 7F06                    			jg stocare_litera
    62                                  			
    63 00000041 3C39                    			cmp al,"9"
    64 00000043 7408                    			je stocare_noua
    65                                  			
    66 00000045 FEC0                    			inc al
    67                                  			
    68                                  			stocare_litera:
    69 00000047 8807                    				mov byte[edi],al
    70 00000049 47                      				inc edi
    71 0000004A 46                      				inc esi
    72 0000004B EBE2                    			jmp modificare_sir	
    73                                  			
    74                                  			stocare_noua:
    75 0000004D B431                    				mov ah,"1"
    76 0000004F B030                    				mov al,"0"
    77 00000051 8827                    				mov byte[edi],ah
    78 00000053 47                      				inc edi
    79 00000054 8807                    				mov byte[edi],al
    80 00000056 47                      				inc edi
    81 00000057 46                      				inc esi
    82 00000058 EBD5                    			jmp modificare_sir
    83                                  		
    84                                  		done:
    85                                      
    86 0000005A FF35[79000000]          		push dword [id]
    87 00000060 FF15[00000000]          		call [fclose]
    88 00000066 83C404                  		add esp,4
    89                                  		
    90 00000069 68[E1000000]            		push access_write
    91 0000006E 68[0A000000]            		push output
    92 00000073 FF15[00000000]          		call [fopen]
    93 00000079 83C408                  		add esp,4*2
    94                                  		
    95 0000007C A3[79000000]            		mov [id],eax
    96                                  
    97 00000081 68[7D000000]            		push sir_final
    98 00000086 68[E5000000]            		push string
    99 0000008B FF35[79000000]          		push dword [id]
   100 00000091 FF15[00000000]          		call [fprintf]
   101 00000097 83C408                  		add esp,4*2
   102                                  		
   103 0000009A FF35[79000000]          		push dword[id]
   104 000000A0 FF15[00000000]          		call [fclose]
   105                                  		
   106                                          ; exit(0)
   107 000000A6 6A00                            push    dword 0      ; push the parameter for exit onto the stack
   108 000000A8 FF15[00000000]                  call    [exit]       ; call exit to terminate the program
